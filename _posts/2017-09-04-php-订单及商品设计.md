---
layout:     post
title:      "电商订单系统设计"
subtitle:   "电商订单系统设计"
date:       2017-09-04 12:00:00
author:     "Ikin"
catalog: laravel
tags:
    - php
    - mysql
    - 电商
    - 订单设计
---

> 订单系统设计有很多种但一定要结合自己的系统设计

## 问题一 订单和商品数据如何处理

```
* 方案一
在订单创建的时候直接把商品数据保存在订单里面，作为订单的一个附属字段
这样子后续修改商品，不会对已经在订单内的商品任何影响
问题：如果商品修改不频繁的情况下，会大量增加订单数据的大小，同一个商品下10单，10个单里面都有商品数据（特别是需求显示商品的字段较多时，比如规格，产地，单位等等)

* 方案二
在订单创建的时候，对商品生成一个快照存在一个商品快照表中（同一个商品可含多个快照，订单创建时判断商品快照是否为最新，最新则不新生成快照），订单内存储商品快照ID，显示订单商品时，用ID去取商品快照显示
这样子后续修改商品，不会对已经在订单内的商品任何影响，
问题：比如订单只保存最近一年，一年以前订单自动归档，那商品快照表就需要单独处理判断商品的快照是否该归档，如果商品快照不定期归档，数据量会无限变大

* 方案三
创建订单直接保存商品ID，显示商品的时候在去商品表里查询商品
这样子最节省空间
问题：如果商品删除或者修改了之后，订单也会跟着变(显然这种设计不行)
```
##### 传统解决方案：采用方案1 + 方案2 模式
* 首先在编辑成功商品时可以生成商品快照记录在一个单独的表里，如果担心数据量变大以后可以进行归档。
* 其次订单保留快照id，及一些必要的信息，方便查询和筛选

##### 其它情况
但是，当我们的商品来源于三方时（或者你以后会接入第三方时候）意思就是你其实不知道商品说明时候更新，那么应该怎么办？   
* 这个时候我们选择直接在订单里保存商品信息，又或者与第三方约定好版本号，这样你就可以用上述方案。
* 做请求刷新，也就是说生成订单快照的时候去请求第三方资源（请注意此处有坑，如果第三方服务挂了呢？）。目前我的三方系统是部署在自己服务机器上，所以不会有这种问题。


